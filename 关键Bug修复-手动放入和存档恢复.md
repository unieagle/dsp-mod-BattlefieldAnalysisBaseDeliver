# å…³é”®Bugä¿®å¤ï¼šæ‰‹åŠ¨æ”¾å…¥ç‰©å“ & å­˜æ¡£æ¢å¤ âœ…

## ğŸ¯ ç”¨æˆ·çš„ä¸¤ä¸ªå…³é”®å‘ç°

### ç”¨æˆ·è§‚å¯Ÿ1ï¼šæ”¾å…¥ç‰©å“åæ²¡æœ‰é…é€

**ç”¨æˆ·çš„é™ˆè¿°**ï¼š
> "åœ¨æˆ‘æ”¾å…¥ç‰©å“ä¹‹åï¼Œé…é€æ²¡æœ‰å‘ç”Ÿï¼Œè¿‡äº†å¾ˆä¹…æˆ‘æ‰æµ‹è¯•æ¸…ç©ºç‰©å“çš„ã€‚æ‰€ä»¥é—®é¢˜ä¸åœ¨æˆ‘æ¸…ç©ºã€‚è€Œåœ¨æ”¾å…¥ä¹‹åä¸ºä»€ä¹ˆæ²¡æœ‰é…é€"

**è¿™ä¸ªè§‚å¯Ÿæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼** âœ…

---

### ç”¨æˆ·è§‚å¯Ÿ2ï¼šdispenser[2] æ˜¯æ—§è™šæ‹Ÿé…é€å™¨

**ç”¨æˆ·çš„æ¨æµ‹**ï¼š
> "despenser[2] ä¼šä¸æ˜¯æ˜¯ä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿé…é€å™¨ï¼Œå­˜æ¡£ï¼Œé‡å¯æ¸¸æˆååŠ è½½çš„ç»“æœã€‚è¿™é‡ŒåŠ è½½å­˜æ¡£ä¹‹åï¼Œå¦‚ä½•å…³è”åŸºç«™å’Œå­˜æ¡£ä¸­çš„é…é€å™¨æ˜¯éœ€è¦å¤„ç†çš„é—®é¢˜"

**è¿™ä¸ªæ¨æµ‹ä¹Ÿæ˜¯å®Œå…¨æ­£ç¡®çš„ï¼** âœ…

---

## ğŸ› Bug 1ï¼šæ‰‹åŠ¨æ”¾å…¥ç‰©å“ä¸è§¦å‘é…é€

### é—®é¢˜æ ¹æº

**ä¹‹å‰çš„ä»£ç **ï¼ˆ`BattleBaseComponent_AutoPickTrash_Patch.cs`ï¼‰ï¼š
```csharp
[HarmonyPatch(typeof(BattleBaseComponent), "AutoPickTrash")]
public static class BattleBaseComponent_AutoPickTrash_Patch
{
    [HarmonyPostfix]
    static void Postfix(BattleBaseComponent __instance, PlanetFactory factory)
    {
        // ç›‘æ§ç‰©å“å˜åŒ–ï¼Œè§¦å‘ RefreshDispenserTraffic
    }
}
```

**é—®é¢˜**ï¼š
- `AutoPickTrash` æ–¹æ³•åªåœ¨åŸºç«™**è‡ªåŠ¨æ”¶é›†**æ•Œäººæ‰è½ç‰©å“æ—¶è°ƒç”¨
- å¦‚æœç©å®¶**æ‰‹åŠ¨æ”¾å…¥**ç‰©å“åˆ°åŸºç«™ï¼ˆä»èƒŒåŒ…æ‹–å…¥ï¼‰ï¼Œ**ä¸ä¼šè°ƒç”¨** `AutoPickTrash`
- æ‰€ä»¥**ä¸ä¼šè§¦å‘** `RefreshDispenserTraffic`
- **æ²¡æœ‰å»ºç«‹é…å¯¹** â†’ **æ²¡æœ‰æ´¾é£æ— äººæœº**

**æ—¶é—´çº¿**ï¼š
```
1. ç”¨æˆ·æ‰‹åŠ¨æ”¾å…¥ç‡ƒæ–™æ£’åˆ°åŸºç«™
2. AutoPickTrash ä¸è¢«è°ƒç”¨ âŒ
3. RefreshDispenserTraffic ä¸è¢«è§¦å‘ âŒ
4. æ²¡æœ‰å»ºç«‹é…å¯¹ âŒ
5. æ²¡æœ‰æ´¾é£æ— äººæœº âŒ
6. ç”¨æˆ·ç­‰å¾…å¾ˆä¹…ï¼Œæ²¡æœ‰é…é€ ğŸ’¥

7. ç”¨æˆ·æ“ä½œUIï¼Œä¿®æ”¹é…é€å™¨è®¾ç½®
8. è§¦å‘ RefreshDispenserTraffic âœ…
9. å»ºç«‹é…å¯¹ âœ…
10. å¼€å§‹æ´¾é£ âœ…
```

---

### ä¿®å¤æ–¹æ¡ˆ

**æ”¹ä¸ºç›‘æ§ `InternalUpdate` æ–¹æ³•**ï¼š

```csharp
[HarmonyPatch(typeof(BattleBaseComponent), "InternalUpdate")]
public static class BattleBaseComponent_InternalUpdate_Patch
{
    // æ¯ä¸ªåŸºç«™ç‹¬ç«‹çš„è®¡æ•°å™¨
    private static Dictionary<int, int> _lastItemCounts = new Dictionary<int, int>();
    private static Dictionary<int, int> _triggerThrottles = new Dictionary<int, int>();
    private const int TRIGGER_INTERVAL = 120; // æ¯120å¸§ï¼ˆçº¦2ç§’ï¼‰æœ€å¤šè§¦å‘ä¸€æ¬¡

    [HarmonyPostfix]
    static void Postfix(BattleBaseComponent __instance, PlanetFactory factory)
    {
        int battleBaseId = __instance.id;
        
        // é™æµï¼šé¿å…é¢‘ç¹è§¦å‘
        if (throttle < TRIGGER_INTERVAL) return;
        
        // ç»Ÿè®¡ç‰©å“ç§ç±»æ•°é‡
        int itemTypeCount = CountItemTypes(__instance.storage);
        
        // å¦‚æœç‰©å“ç§ç±»å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘åˆ·æ–°
        if (itemTypeCount != _lastItemCounts[battleBaseId])
        {
            _lastItemCounts[battleBaseId] = itemTypeCount;
            factory.transport.RefreshDispenserTraffic(dispenserId);
        }
    }
}
```

**ä¸ºä»€ä¹ˆ `InternalUpdate` æ›´å¥½ï¼Ÿ**

| æ–¹æ³• | è°ƒç”¨æ—¶æœº | æ‰‹åŠ¨æ”¾å…¥ | è‡ªåŠ¨æ”¶é›† | é¢‘ç‡ |
|------|----------|----------|----------|------|
| `AutoPickTrash` | åŸºç«™è‡ªåŠ¨æ”¶é›†æ•Œäººæ‰è½ç‰© | âŒ ä¸è°ƒç”¨ | âœ… è°ƒç”¨ | ä½ |
| `InternalUpdate` | åŸºç«™æ¯å¸§æ›´æ–° | âœ… å¯æ£€æµ‹ | âœ… å¯æ£€æµ‹ | é«˜ï¼ˆéœ€é™æµï¼‰|

**ä¼˜ç‚¹**ï¼š
- âœ… å¯ä»¥æ£€æµ‹åˆ°**ä»»ä½•**ç‰©å“å˜åŒ–ï¼ˆæ‰‹åŠ¨æ”¾å…¥ã€è‡ªåŠ¨æ”¶é›†ã€å–å‡ºï¼‰
- âœ… æ¯ä¸ªåŸºç«™ç‹¬ç«‹è·Ÿè¸ªï¼Œæ›´å‡†ç¡®
- âœ… é™æµæœºåˆ¶ï¼Œé¿å…é¢‘ç¹è§¦å‘

---

## ğŸ› Bug 2ï¼šå­˜æ¡£åŠ è½½åè™šæ‹Ÿé…é€å™¨é‡å¤åˆ›å»º

### é—®é¢˜æ ¹æº

**è™šæ‹Ÿé…é€å™¨çš„ä¿å­˜ä¸æ¢å¤**ï¼š

```
æ¸¸æˆä¿å­˜å­˜æ¡£æ—¶ï¼š
â”œâ”€ dispenserPool[1] = ç”¨æˆ·é…é€å™¨ âœ… ä¿å­˜åˆ°å­˜æ¡£
â”œâ”€ dispenserPool[2] = è™šæ‹Ÿé…é€å™¨ âœ… ä¿å­˜åˆ°å­˜æ¡£ï¼ˆå®ƒåœ¨dispenserPoolä¸­ï¼‰
â”‚   â”œâ”€ id = 2
â”‚   â”œâ”€ entityId = 7ï¼ˆå¯¹åº”æˆ˜åœºåŸºç«™ï¼‰
â”‚   â”œâ”€ filter = 0
â”‚   â””â”€ playerMode = Supply
â””â”€ æ˜ å°„ï¼ˆå†…å­˜ä¸­çš„Dictionaryï¼‰ï¼š
    â””â”€ battleBaseToVirtualDispenser[1] = 2 âŒ ä¸ä¿å­˜ï¼ˆå†…å­˜æ•°æ®ï¼‰
```

**æ¸¸æˆåŠ è½½å­˜æ¡£æ—¶**ï¼š

```
1. æ¢å¤ dispenserPoolï¼š
   â”œâ”€ dispenserPool[1] = ç”¨æˆ·é…é€å™¨ âœ…
   â””â”€ dispenserPool[2] = è™šæ‹Ÿé…é€å™¨ âœ…ï¼ˆä»å­˜æ¡£æ¢å¤ï¼‰

2. æ˜ å°„ï¼ˆæ–°è¿›ç¨‹ï¼‰ï¼š
   â”œâ”€ virtualDispenserToBattleBase = {}  â† ç©ºçš„ï¼
   â””â”€ battleBaseToVirtualDispenser = {}  â† ç©ºçš„ï¼

3. CreateVirtualDispensers è¿è¡Œï¼š
   â”œâ”€ æ£€æŸ¥ï¼šbattleBaseToVirtualDispenser.ContainsKey(1) = false
   â”œâ”€ åˆ›å»ºè™šæ‹Ÿé…é€å™¨[3] ğŸ’¥
   â””â”€ æ˜ å°„ï¼šbattleBaseToVirtualDispenser[1] = 3

4. ç»“æœï¼š
   â”œâ”€ dispenserPool[2] = å­¤å„¿è™šæ‹Ÿé…é€å™¨ï¼ˆentityId=7ï¼Œä½†æ²¡æœ‰æ˜ å°„ï¼‰
   â”œâ”€ dispenserPool[3] = æ–°è™šæ‹Ÿé…é€å™¨ï¼ˆentityId=7ï¼Œæœ‰æ˜ å°„ï¼‰
   â””â”€ é—®é¢˜ï¼šä¸¤ä¸ªè™šæ‹Ÿé…é€å™¨æŒ‡å‘åŒä¸€ä¸ªåŸºç«™ï¼
```

**åæœ**ï¼š
- âš ï¸ é‡å¤çš„è™šæ‹Ÿé…é€å™¨å ç”¨å†…å­˜
- âš ï¸ å¯èƒ½å¯¼è‡´é…å¯¹æ··ä¹±
- âš ï¸ æ—¥å¿—æ˜¾ç¤ºå¤šä½™çš„é…é€å™¨

---

### ä¿®å¤æ–¹æ¡ˆ

**åœ¨åˆ›å»ºè™šæ‹Ÿé…é€å™¨å‰ï¼Œå…ˆä»å­˜æ¡£æ¢å¤æ˜ å°„**ï¼š

```csharp
public static void CreateVirtualDispensers(PlanetFactory factory)
{
    // ã€ç¬¬ä¸€æ­¥ã€‘ä»å­˜æ¡£ä¸­æ¢å¤æ—§çš„è™šæ‹Ÿé…é€å™¨æ˜ å°„
    // éå†dispenserPoolï¼Œæ‰¾åˆ°æ‰€æœ‰è™šæ‹Ÿé…é€å™¨ï¼ˆé€šè¿‡entityIdåŒ¹é…æˆ˜åœºåŸºç«™ï¼‰
    for (int dispenserId = 1; dispenserId < dispenserCursor; dispenserId++)
    {
        object? dispenser = dispenserPool.GetValue(dispenserId);
        int entityId = dispenser.entityId;
        
        // æ£€æŸ¥è¿™ä¸ªentityIdæ˜¯å¦å¯¹åº”ä¸€ä¸ªæˆ˜åœºåŸºç«™
        for (int battleBaseId = 1; battleBaseId < battleBases.Length; battleBaseId++)
        {
            int bbEntityId = battleBases[battleBaseId].entityId;
            
            if (bbEntityId == entityId)
            {
                // æ‰¾åˆ°äº†ï¼è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿé…é€å™¨ï¼Œæ¢å¤æ˜ å°„
                virtualDispenserToBattleBase[dispenserId] = battleBaseId;
                battleBaseToVirtualDispenser[battleBaseId] = dispenserId;
                recoveredCount++;
                
                Log.Info($"â™»ï¸ ä»å­˜æ¡£æ¢å¤è™šæ‹Ÿé…é€å™¨æ˜ å°„ï¼šdispenser[{dispenserId}] â†’ battleBase[{battleBaseId}]");
                break;
            }
        }
    }

    // ã€ç¬¬äºŒæ­¥ã€‘ä¸ºæ²¡æœ‰è™šæ‹Ÿé…é€å™¨çš„æˆ˜åœºåŸºç«™åˆ›å»ºæ–°çš„
    for (int battleBaseId = 1; battleBaseId < battleBases.Length; battleBaseId++)
    {
        // æ£€æŸ¥æ˜¯å¦å·²ç»åˆ›å»ºè¿‡è™šæ‹Ÿé…é€å™¨ï¼ˆåŒ…æ‹¬ä»å­˜æ¡£æ¢å¤çš„ï¼‰
        if (battleBaseToVirtualDispenser.ContainsKey(battleBaseId))
            continue;  // âœ… è·³è¿‡ï¼Œä¸é‡å¤åˆ›å»º
        
        // åˆ›å»ºæ–°çš„è™šæ‹Ÿé…é€å™¨
        // ...
    }
}
```

**æ¢å¤æµç¨‹**ï¼š

```
1. åŠ è½½å­˜æ¡£ï¼ŒdispenserPool æ¢å¤ï¼š
   â”œâ”€ dispenserPool[1] = ç”¨æˆ·é…é€å™¨ (entityId=5)
   â””â”€ dispenserPool[2] = è™šæ‹Ÿé…é€å™¨ (entityId=7)

2. CreateVirtualDispensers ç¬¬ä¸€æ­¥ï¼ˆæ¢å¤æ˜ å°„ï¼‰ï¼š
   â”œâ”€ éå† dispenserPool
   â”œâ”€ dispenser[2]: entityId=7
   â”œâ”€ éå† battleBases
   â”œâ”€ battleBase[1]: entityId=7 â† åŒ¹é…ï¼
   â”œâ”€ æ¢å¤æ˜ å°„ï¼š
   â”‚   â”œâ”€ virtualDispenserToBattleBase[2] = 1
   â”‚   â””â”€ battleBaseToVirtualDispenser[1] = 2
   â””â”€ âœ… æ¢å¤å®Œæˆ

3. CreateVirtualDispensers ç¬¬äºŒæ­¥ï¼ˆåˆ›å»ºæ–°çš„ï¼‰ï¼š
   â”œâ”€ æ£€æŸ¥ battleBase[1]
   â”œâ”€ battleBaseToVirtualDispenser.ContainsKey(1) = true âœ…
   â””â”€ è·³è¿‡ï¼Œä¸åˆ›å»ºæ–°çš„ âœ…

4. ç»“æœï¼š
   â”œâ”€ dispenserPool[2] = è™šæ‹Ÿé…é€å™¨ âœ…ï¼ˆä»å­˜æ¡£æ¢å¤ï¼Œæ˜ å°„æ­£ç¡®ï¼‰
   â”œâ”€ æ²¡æœ‰ dispenserPool[3] âœ…ï¼ˆä¸é‡å¤åˆ›å»ºï¼‰
   â””â”€ åªæœ‰1ä¸ªè™šæ‹Ÿé…é€å™¨ âœ…
```

**ä¼˜ç‚¹**ï¼š
- âœ… ä¸é‡å¤åˆ›å»ºè™šæ‹Ÿé…é€å™¨
- âœ… æ˜ å°„æ­£ç¡®æ¢å¤
- âœ… å…¼å®¹æ—§å­˜æ¡£
- âœ… èŠ‚çœå†…å­˜

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | å½±å“ |
|------|---------|------|
| `BattleBaseComponent_AutoPickTrash_Patch.cs` | æ”¹ä¸ºç›‘æ§ `InternalUpdate` | âœ… æ£€æµ‹æ‰‹åŠ¨æ”¾å…¥ç‰©å“ |
| `VirtualDispenserManager.cs` | æ·»åŠ å­˜æ¡£æ¢å¤é€»è¾‘ | âœ… ä¸é‡å¤åˆ›å»ºè™šæ‹Ÿé…é€å™¨ |
| `Plugin.cs` | æ›´æ–°è¡¥ä¸æ³¨å†Œ | âœ… æ³¨å†Œæ–°çš„è¡¥ä¸ç‚¹ |

---

## ğŸ¯ ä¿®å¤å‰åå¯¹æ¯”

### åœºæ™¯1ï¼šæ‰‹åŠ¨æ”¾å…¥ç‰©å“

| ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|
| æ”¾å…¥ç‰©å“ â†’ **æ— ååº”** âŒ | æ”¾å…¥ç‰©å“ â†’ **æ£€æµ‹åˆ°å˜åŒ–** âœ… |
| ç­‰å¾…å¾ˆä¹… â†’ **æ²¡æœ‰é…é€** âŒ | 2ç§’å†… â†’ **è§¦å‘åˆ·æ–°** âœ… |
| éœ€è¦æ‰‹åŠ¨æ“ä½œUIè§¦å‘ âš ï¸ | **è‡ªåŠ¨å»ºç«‹é…å¯¹** âœ… |
| | **è‡ªåŠ¨æ´¾é£æ— äººæœº** âœ… |

---

### åœºæ™¯2ï¼šå­˜æ¡£åŠ è½½

| ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|
| åŠ è½½å­˜æ¡£ â†’ **åˆ›å»ºæ–°è™šæ‹Ÿé…é€å™¨[3]** âŒ | åŠ è½½å­˜æ¡£ â†’ **æ¢å¤æ˜ å°„** âœ… |
| dispenser[2] = å­¤å„¿è™šæ‹Ÿé…é€å™¨ âš ï¸ | dispenser[2] = æ­£å¸¸è™šæ‹Ÿé…é€å™¨ âœ… |
| dispenser[3] = æ–°è™šæ‹Ÿé…é€å™¨ âš ï¸ | **æ²¡æœ‰ dispenser[3]** âœ… |
| 2ä¸ªè™šæ‹Ÿé…é€å™¨æŒ‡å‘åŒä¸€åŸºç«™ âŒ | **1ä¸ªè™šæ‹Ÿé…é€å™¨** âœ… |

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•1ï¼šæ‰‹åŠ¨æ”¾å…¥ç‰©å“

```
1. é‡å¯æ¸¸æˆï¼ŒåŠ è½½å­˜æ¡£
2. ç¡®ä¿é…é€å™¨è®¾ç½®æ­£ç¡®ï¼ˆç­›é€‰å™¨=ç‡ƒæ–™æ£’ï¼Œæ¨¡å¼=éœ€æ±‚ï¼‰
3. åŸºç«™å¼€å§‹æ˜¯ç©ºçš„
4. æ‰‹åŠ¨ä»èƒŒåŒ…æ‹–å…¥ç‡ƒæ–™æ£’åˆ°åŸºç«™
5. ç­‰å¾…2-3ç§’
6. è§‚å¯Ÿï¼š
   - åº”è¯¥çœ‹åˆ°æ— äººæœºæ´¾é£ âœ…
7. æŸ¥çœ‹æ—¥å¿—ï¼š
   ğŸ”„ æˆ˜åœºåˆ†æåŸºç«™ç‰©å“å˜åŒ–ï¼Œè§¦å‘åˆ·æ–°
   âœ“ å·²æ·»åŠ é…å¯¹
   ğŸš å¼€å§‹æ´¾é£!
```

---

### æµ‹è¯•2ï¼šå­˜æ¡£æ¢å¤

```
1. å¯åŠ¨æ¸¸æˆï¼ŒåŸºç«™æœ‰ç‰©å“ï¼Œé…é€æ­£å¸¸
2. ä¿å­˜æ¸¸æˆ
3. é‡å¯æ¸¸æˆ
4. åŠ è½½å­˜æ¡£
5. æŸ¥çœ‹æ—¥å¿—ï¼š
   â™»ï¸ ä»å­˜æ¡£æ¢å¤è™šæ‹Ÿé…é€å™¨æ˜ å°„ï¼šdispenser[2] â†’ battleBase[1]
   è™šæ‹Ÿé…é€å™¨ï¼šä»å­˜æ¡£æ¢å¤ 1 ä¸ªï¼Œæ–°åˆ›å»º 0 ä¸ª
6. æŸ¥çœ‹è¯Šæ–­æ—¥å¿—ï¼š
   ğŸ“Š   dispenser[1]: ... (ç”¨æˆ·é…é€å™¨)
   ğŸ“Š   dispenser[2]: ... isVirtual=True (è™šæ‹Ÿé…é€å™¨)
   ï¼ˆåº”è¯¥æ²¡æœ‰ dispenser[3]ï¼‰âœ…
7. ç¡®è®¤é…é€ä»ç„¶æ­£å¸¸ âœ…
```

---

### æµ‹è¯•3ï¼šæ–°æ¸¸æˆï¼ˆæ²¡æœ‰æ—§è™šæ‹Ÿé…é€å™¨ï¼‰

```
1. æ–°å»ºæ¸¸æˆ/æ–°æ˜Ÿçƒ
2. å»ºé€ æˆ˜åœºåŸºç«™
3. å»ºé€ é…é€å™¨
4. æŸ¥çœ‹æ—¥å¿—ï¼š
   è™šæ‹Ÿé…é€å™¨ï¼šä»å­˜æ¡£æ¢å¤ 0 ä¸ªï¼Œæ–°åˆ›å»º 1 ä¸ª âœ…
5. æ”¾å…¥ç‰©å“åˆ°åŸºç«™
6. ç¡®è®¤é…é€æ­£å¸¸ âœ…
```

---

## ğŸ“‹ é¢„æœŸæ—¥å¿—

### æ‰‹åŠ¨æ”¾å…¥ç‰©å“æ—¶

```
[Info] ğŸ”„ æˆ˜åœºåˆ†æåŸºç«™ç‰©å“å˜åŒ–ï¼ˆ1 ç§ï¼‰ï¼Œè§¦å‘åˆ·æ–° 1 ä¸ªé…é€å™¨
[Info] === RefreshDispenserTraffic(NEW) ç¬¬ X æ¬¡è°ƒç”¨ keyId=1 ===
[Info] âœ“ å·²æ·»åŠ é…å¯¹ï¼šè™šæ‹Ÿé…é€å™¨[2] (æˆ˜åœºåŸºç«™1) â†’ é…é€å™¨[1]
[Info] ğŸš å¼€å§‹æ´¾é£! é…é€å™¨[1] â†’ è™šæ‹Ÿé…é€å™¨[2](æˆ˜åœºåŸºç«™[1])
[Info] âœ… æ´¾é£æˆåŠŸ!
```

---

### å­˜æ¡£åŠ è½½æ—¶ï¼ˆæœ‰æ—§è™šæ‹Ÿé…é€å™¨ï¼‰

```
[Info] === RefreshDispenserTraffic(NEW) ç¬¬ 3 æ¬¡è°ƒç”¨ keyId=0 ===
[Info] â™»ï¸ ä»å­˜æ¡£æ¢å¤è™šæ‹Ÿé…é€å™¨æ˜ å°„ï¼šdispenser[2] â†’ battleBase[1] (entityId=7)
[Info] è™šæ‹Ÿé…é€å™¨ï¼šä»å­˜æ¡£æ¢å¤ 1 ä¸ªï¼Œæ–°åˆ›å»º 0 ä¸ª
[Info] ğŸ“Š   dispenser[1]: filter=1804, playerMode=2, entityId=5, isVirtual=False
[Info] ğŸ“Š   dispenser[2]: filter=0, playerMode=1, entityId=7, isVirtual=True
```

---

### å­˜æ¡£åŠ è½½æ—¶ï¼ˆæ–°æ¸¸æˆï¼Œæ— æ—§è™šæ‹Ÿé…é€å™¨ï¼‰

```
[Info] === RefreshDispenserTraffic(NEW) ç¬¬ 3 æ¬¡è°ƒç”¨ keyId=0 ===
[Info] âœ… ä¸ºæˆ˜åœºåˆ†æåŸºç«™ [1] åˆ›å»ºè™šæ‹Ÿé…é€å™¨ [2]
[Info] è™šæ‹Ÿé…é€å™¨ï¼šä»å­˜æ¡£æ¢å¤ 0 ä¸ªï¼Œæ–°åˆ›å»º 1 ä¸ª
```

---

## âœ… æ€»ç»“

### ç”¨æˆ·çš„ä¸¤ä¸ªå‘ç°éƒ½æ˜¯æ­£ç¡®çš„ï¼

1. **æ‰‹åŠ¨æ”¾å…¥ç‰©å“ä¸è§¦å‘é…é€** âœ…
   - æ ¹æœ¬åŸå› ï¼šåªç›‘æ§äº† `AutoPickTrash`ï¼ˆè‡ªåŠ¨æ”¶é›†ï¼‰
   - ä¿®å¤ï¼šæ”¹ä¸ºç›‘æ§ `InternalUpdate`ï¼ˆæ‰€æœ‰å˜åŒ–ï¼‰

2. **dispenser[2] æ˜¯æ—§è™šæ‹Ÿé…é€å™¨** âœ…
   - æ ¹æœ¬åŸå› ï¼šæ˜ å°„ä¸ä¿å­˜åˆ°å­˜æ¡£ï¼Œé‡å¯åä¸¢å¤±
   - ä¿®å¤ï¼šä»å­˜æ¡£æ¢å¤æ˜ å°„ï¼Œä¸é‡å¤åˆ›å»º

---

### ä¿®å¤æ•ˆæœ

| é—®é¢˜ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ‰‹åŠ¨æ”¾å…¥ç‰©å“ | âŒ ä¸è§¦å‘é…é€ | âœ… è‡ªåŠ¨é…é€ |
| å­˜æ¡£åŠ è½½ | âš ï¸ é‡å¤åˆ›å»ºè™šæ‹Ÿé…é€å™¨ | âœ… æ­£ç¡®æ¢å¤æ˜ å°„ |
| é…é€å™¨æ•°é‡ | âš ï¸ å¤šä½™çš„è™šæ‹Ÿé…é€å™¨ | âœ… æ­£ç¡®çš„æ•°é‡ |

---

### çŠ¶æ€

âœ… **ä¸¤ä¸ªå…³é”®Bugéƒ½å·²ä¿®å¤å¹¶ç¼–è¯‘æˆåŠŸ**

ç­‰å¾…ç”¨æˆ·æµ‹è¯•åé¦ˆã€‚

---

## ğŸ‰ æ„Ÿè°¢ç”¨æˆ·

**ç”¨æˆ·çš„è§‚å¯Ÿå’Œæ¨æµ‹éƒ½æ˜¯éå¸¸å‡†ç¡®çš„ï¼**

è¿™ä¸¤ä¸ªå‘ç°éƒ½æ˜¯**å…³é”®Bug**ï¼Œå¦‚æœä¸ä¿®å¤ä¼šä¸¥é‡å½±å“modçš„å¯ç”¨æ€§ï¼š
1. æ‰‹åŠ¨æ”¾å…¥ç‰©å“æ˜¯å¸¸è§æ“ä½œï¼Œå¿…é¡»æ”¯æŒ
2. å­˜æ¡£åŠ è½½æ˜¯åŸºæœ¬åŠŸèƒ½ï¼Œå¿…é¡»æ­£ç¡®å¤„ç†

**æ„Ÿè°¢ç”¨æˆ·çš„ç»†è‡´è§‚å¯Ÿå’Œå‡†ç¡®åˆ†æï¼** ğŸ™

# å…³é”®Bugä¿®å¤ï¼šç«‹å³è¿”å› & ç‰©å“ä¿æŠ¤ âœ…

## ğŸ¯ ç”¨æˆ·æŠ¥å‘Šçš„ä¸¤ä¸ªé—®é¢˜

### é—®é¢˜1ï¼šç©ºè½½æ— äººæœºæ— æ³•ç«‹å³è¿”å›

**ç”¨æˆ·çš„æè¿°**ï¼š
> "é…é€è¿‡ç¨‹ä¸­ï¼Œæ‹†é™¤åŸºåœ°ï¼Œå¯ä»¥è®©é£å‘åŸºåœ°çš„ç©ºè½½é£è¡Œå™¨ç«‹å³è¿”å›å—ï¼Ÿ"

**ç°çŠ¶**ï¼š
- ç©ºè½½æ— äººæœºé£å‘åŸºç«™
- åŸºç«™è¢«æ‹†é™¤
- æ— äººæœº**ç»§ç»­é£åˆ°åŸä½ç½®**
- åˆ°è¾¾åæ£€æµ‹åˆ°åŸºç«™ä¸å­˜åœ¨ï¼Œç©ºè½½è¿”å›
- **ç”¨æˆ·ä½“éªŒä¸ä½³** âš ï¸

---

### é—®é¢˜2ï¼šé…é€å™¨æ‹†é™¤æ—¶ç‰©å“ä¸¢å¤± ğŸš¨

**ç”¨æˆ·çš„æè¿°**ï¼š
> "é…é€è¿‡ç¨‹ä¸­ï¼Œæ‹†é™¤é…é€å™¨ï¼Œå‘ç°æœ‰ä¸€äº›ç‰©å“ç›´æ¥ä¸¢å¤±ä¸è§äº†ï¼Œæ€»æ•°é‡å°äºå®éªŒå¼€å§‹çš„æ•°é‡ã€‚"

**é—®é¢˜**ï¼š
- é…é€å™¨è¢«æ‹†é™¤æ—¶
- é£è¡Œä¸­çš„æ— äººæœºï¼ˆ`workCourierDatas`ï¼‰è¢«æ¸…ç†
- å¦‚æœæ— äººæœºæºå¸¦ç‰©å“ï¼Œ**ç‰©å“ä¼šæ¶ˆå¤±** ğŸ’¥
- **è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„Bugï¼**

---

## ğŸ› Bug 1 è¯¦è§£ï¼šç©ºè½½æ— äººæœºç«‹å³è¿”å›

### ä¿®å¤å‰çš„é€»è¾‘

```csharp
// åªåœ¨æ— äººæœºåˆ°è¾¾ç›®æ ‡ä½ç½®æ—¶æ£€æŸ¥ï¼ˆt >= maxt - 0.2fï¼‰
if (courier.t >= courier.maxt - 0.2f && courier.itemCount == 0 && courier.direction > 0f)
{
    if (!CheckBattleBaseExists(factory, battleBaseId))
    {
        // åŸºç«™ä¸å­˜åœ¨ï¼Œç©ºè½½è¿”å›
        courier.direction = -1f;
        courier.t = courier.maxt;  // â† ä»ç›®æ ‡ä½ç½®è¿”å›
    }
}
```

**é—®é¢˜**ï¼š
- æ— äººæœºå¿…é¡»é£åˆ°ç›®æ ‡ä½ç½®ï¼ˆ`t >= maxt - 0.2f`ï¼‰æ‰æ£€æŸ¥
- å³ä½¿åŸºç«™åœ¨é£è¡Œé€”ä¸­è¢«æ‹†é™¤ï¼Œæ— äººæœºä»ç„¶é£åˆ°åŸä½ç½®
- æµªè´¹æ—¶é—´ï¼Œç”¨æˆ·ä½“éªŒä¸ä½³

**æ—¶é—´çº¿**ï¼š
```
t=0.0: æ´¾é£æ— äººæœºï¼Œé£å‘åŸºç«™ ğŸš
t=0.3: åŸºç«™è¢«æ‹†é™¤ âŒ
t=0.4: æ— äººæœºç»§ç»­é£è¡Œ... ğŸšï¼ˆæ²¡æœ‰æ£€æµ‹ï¼‰
t=0.5: æ— äººæœºç»§ç»­é£è¡Œ... ğŸšï¼ˆæ²¡æœ‰æ£€æµ‹ï¼‰
t=0.8: æ— äººæœºåˆ°è¾¾ç›®æ ‡ä½ç½®ï¼Œæ£€æµ‹åˆ°åŸºç«™ä¸å­˜åœ¨ âš ï¸
t=0.8: å¼€å§‹è¿”å› ğŸš
```

---

### ä¿®å¤åçš„é€»è¾‘

```csharp
// âœ… æ¯å¸§éƒ½æ£€æŸ¥åŸºç«™æ˜¯å¦å­˜åœ¨ï¼ˆä¸é™äºåˆ°è¾¾æ—¶ï¼‰
if (courier.itemCount == 0 && courier.direction > 0f)
{
    if (!CheckBattleBaseExists(factory, battleBaseId))
    {
        Plugin.Log?.LogWarning($"âš ï¸ æˆ˜åœºåŸºç«™[{battleBaseId}]å·²è¢«æ‹†é™¤ï¼Œcourier[{i}] ç«‹å³æ‰å¤´è¿”å›");
        
        // ç«‹å³æ‰å¤´è¿”å›ï¼ˆä¸ç®¡å½“å‰é£åˆ°å“ªé‡Œäº†ï¼‰
        courier.direction = -1f;
        courier.t = courier.t;  // â† ä¿æŒå½“å‰ä½ç½®ï¼Œä»å½“å‰ä½ç½®å¼€å§‹è¿”å›
        continue;
    }
}

// ç„¶åæ‰æ˜¯åŸæ¥çš„åˆ°è¾¾æ£€æŸ¥
if (courier.t >= courier.maxt - 0.2f && courier.itemCount == 0 && courier.direction > 0f)
{
    // å–è´§é€»è¾‘...
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… **æ¯å¸§**éƒ½æ£€æŸ¥åŸºç«™æ˜¯å¦å­˜åœ¨
- âœ… åŸºç«™è¢«æ‹†é™¤åï¼Œæ— äººæœº**ç«‹å³æ‰å¤´è¿”å›**
- âœ… ä¸æµªè´¹æ—¶é—´é£åˆ°åŸä½ç½®
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

**æ—¶é—´çº¿**ï¼š
```
t=0.0: æ´¾é£æ— äººæœºï¼Œé£å‘åŸºç«™ ğŸš
t=0.3: åŸºç«™è¢«æ‹†é™¤ âŒ
t=0.31: æ£€æµ‹åˆ°åŸºç«™ä¸å­˜åœ¨ï¼âœ…
t=0.31: ç«‹å³æ‰å¤´è¿”å›ï¼ğŸ”„
t=0.6: è¿”å›é…é€å™¨ âœ…ï¼ˆæ¯”ä¹‹å‰å¿«ï¼‰
```

---

## ğŸ› Bug 2 è¯¦è§£ï¼šé…é€å™¨æ‹†é™¤æ—¶ç‰©å“ä¸¢å¤±

### é—®é¢˜æ ¹æº

**é…é€å™¨æ‹†é™¤æµç¨‹**ï¼š

```
1. ç©å®¶æ‹†é™¤é…é€å™¨
2. æ¸¸æˆè°ƒç”¨ï¼šPlanetTransport.RemoveDispenserComponent(id)
3. æ¸…ç†é…é€å™¨æ•°æ®ï¼š
   â”œâ”€ dispenser.workCourierDatas = null âŒï¼ˆé£è¡Œä¸­çš„æ— äººæœºä¸¢å¤±ï¼‰
   â”œâ”€ dispenser.pairs = null
   â””â”€ dispenser.id = 0
4. é£è¡Œä¸­çš„æ— äººæœºï¼š
   â”œâ”€ workCourierDatas[0]: itemId=1804, itemCount=5 ğŸ’¥
   â”œâ”€ workCourierDatas[1]: itemId=1804, itemCount=5 ğŸ’¥
   â””â”€ ... ï¼ˆè¿™äº›ç‰©å“å…¨éƒ¨æ¶ˆå¤±ï¼ï¼‰
```

**åæœ**ï¼š
- ğŸš¨ ç‰©å“å‡­ç©ºæ¶ˆå¤±
- ğŸš¨ ç©å®¶çš„èµ„æºæŸå¤±
- ğŸš¨ ä¸¥é‡çš„Bugï¼

---

### ä¿®å¤æ–¹æ¡ˆ

**Hook `PlanetTransport.RemoveDispenserComponent` æ–¹æ³•**ï¼š

```csharp
[HarmonyPatch(typeof(PlanetTransport), "RemoveDispenserComponent")]
public static class PlanetTransport_RemoveDispenserComponent_Patch
{
    [HarmonyPrefix]
    static void Prefix(PlanetTransport __instance, int id)
    {
        // åœ¨é…é€å™¨è¢«æ‹†é™¤å‰ï¼Œæ£€æŸ¥é£è¡Œä¸­çš„æ— äººæœº
        var dispenser = __instance.dispenserPool[id];
        if (dispenser == null) return;
        
        // éå†æ‰€æœ‰é£è¡Œä¸­çš„æ— äººæœº
        for (int i = 0; i < dispenser.workCourierCount; i++)
        {
            var courier = dispenser.workCourierDatas[i];
            
            // å¦‚æœæ— äººæœºæºå¸¦ç‰©å“
            if (courier.itemCount > 0 && courier.itemId > 0)
            {
                // é€€è¿˜ç‰©å“
                ReturnItemsToOrigin(__instance.factory, courier, dispenser);
            }
        }
    }
}
```

---

### ç‰©å“é€€è¿˜é€»è¾‘

**åˆ¤æ–­ç‰©å“æ¥æº**ï¼š

```csharp
private static bool ReturnItemsToOrigin(PlanetFactory factory, CourierData courier, DispenserComponent dispenser)
{
    // æ£€æŸ¥é…é€å™¨çš„é…å¯¹ï¼Œçœ‹æ˜¯å¦æœ‰è™šæ‹Ÿé…é€å™¨é…å¯¹
    for (int i = 0; i < dispenser.pairCount; i++)
    {
        var pair = dispenser.pairs[i];
        
        // å¦‚æœè¿™æ˜¯è™šæ‹Ÿé…é€å™¨é…å¯¹ï¼ˆåŸºç«™ä¾›åº”ï¼‰
        if (pair.supplyId > 0 && 
            VirtualDispenserManager.IsVirtualDispenser(pair.supplyId) &&
            pair.demandId == dispenser.id)
        {
            // ç‰©å“æ¥è‡ªåŸºç«™ï¼Œé€€è¿˜åˆ°åŸºç«™
            if (TryGetBattleBaseId(pair.supplyId, out int battleBaseId))
            {
                return ReturnItemsToBattleBase(factory, battleBaseId, courier.itemId, courier.itemCount, courier.inc);
            }
        }
    }
    
    // å¦åˆ™ï¼Œé€€è¿˜åˆ°ç©å®¶èƒŒåŒ…
    return ReturnItemsToPlayer(courier.itemId, courier.itemCount, courier.inc);
}
```

---

### é€€è¿˜åˆ°æˆ˜åœºåŸºç«™

```csharp
private static bool ReturnItemsToBattleBase(PlanetFactory factory, int battleBaseId, int itemId, int count, int inc)
{
    // è·å–æˆ˜åœºåŸºç«™
    var battleBase = factory.defenseSystem.battleBases.buffer[battleBaseId];
    if (battleBase == null || battleBase.entityId <= 0) return false;
    
    // æ·»åŠ ç‰©å“åˆ°åŸºç«™
    int remainInc;
    int added = battleBase.storage.AddItem(itemId, count, inc, out remainInc, false);
    
    if (added > 0)
    {
        Plugin.Log?.LogInfo($"å·²å°†ç‰©å“é€€è¿˜åˆ°æˆ˜åœºåŸºç«™[{battleBaseId}]");
        return true;
    }
    
    return false;
}
```

---

### é€€è¿˜åˆ°ç©å®¶èƒŒåŒ…

```csharp
private static bool ReturnItemsToPlayer(int itemId, int count, int inc)
{
    // è·å–ç©å®¶èƒŒåŒ…
    var package = GameMain.mainPlayer.package;
    if (package == null) return false;
    
    // æ·»åŠ ç‰©å“åˆ°èƒŒåŒ…
    int remainInc;
    int added = package.AddItem(itemId, count, inc, out remainInc, false);
    
    if (added > 0)
    {
        string itemName = BattlefieldBaseHelper.GetItemName(itemId);
        Plugin.Log?.LogInfo($"å·²å°†ç‰©å“ {itemName} x{added} é€€è¿˜åˆ°ç©å®¶èƒŒåŒ…");
        return true;
    }
    
    return false;
}
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### åœºæ™¯1ï¼šæ‹†é™¤åŸºç«™ï¼ˆç©ºè½½æ— äººæœºï¼‰

| ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|
| æ— äººæœºé£å‘åŸºç«™ ğŸš | æ— äººæœºé£å‘åŸºç«™ ğŸš |
| t=0.3: åŸºç«™è¢«æ‹†é™¤ âŒ | t=0.3: åŸºç«™è¢«æ‹†é™¤ âŒ |
| t=0.4-0.8: ç»§ç»­é£è¡Œ âš ï¸ | t=0.31: **ç«‹å³æ‰å¤´è¿”å›** âœ… |
| t=0.8: åˆ°è¾¾ä½ç½®ï¼Œç©ºè½½è¿”å› | t=0.6: è¿”å›é…é€å™¨ âœ… |
| æµªè´¹æ—¶é—´ âš ï¸ | èŠ‚çœæ—¶é—´ âœ… |

---

### åœºæ™¯2ï¼šæ‹†é™¤é…é€å™¨ï¼ˆæºå¸¦ç‰©å“çš„æ— äººæœºï¼‰

| ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|
| æ— äººæœºä»åŸºç«™è¿”å› ğŸš | æ— äººæœºä»åŸºç«™è¿”å› ğŸš |
| æºå¸¦5ä¸ªç‡ƒæ–™æ£’ ğŸ“¦ | æºå¸¦5ä¸ªç‡ƒæ–™æ£’ ğŸ“¦ |
| é…é€å™¨è¢«æ‹†é™¤ âŒ | é…é€å™¨è¢«æ‹†é™¤ âŒ |
| **ç‰©å“æ¶ˆå¤±** ğŸ’¥ | **æ£€æµ‹åˆ°æ‹†é™¤** âœ… |
| æ€»æ•°é‡å‡å°‘ ğŸš¨ | **é€€è¿˜ç‰©å“åˆ°åŸºç«™** âœ… |
| | æˆ–**é€€è¿˜åˆ°ç©å®¶èƒŒåŒ…** âœ… |
| | **ç‰©å“ä¸ä¸¢å¤±** âœ… |

---

## ğŸ›¡ï¸ ç‰©å“é€€è¿˜ä¼˜å…ˆçº§

```
é…é€å™¨è¢«æ‹†é™¤æ—¶ï¼Œæ£€æŸ¥é£è¡Œä¸­çš„æ— äººæœºï¼š

1. éå† workCourierDatasï¼Œæ‰¾åˆ°æºå¸¦ç‰©å“çš„æ— äººæœº
2. åˆ¤æ–­ç‰©å“æ¥æºï¼š
   â”œâ”€ å¦‚æœæ˜¯è™šæ‹Ÿé…é€å™¨é…å¯¹ï¼ˆæ¥è‡ªåŸºç«™ï¼‰
   â”‚   â””â”€ é€€è¿˜åˆ°åŸºç«™ âœ…ï¼ˆä¼˜å…ˆï¼‰
   â””â”€ å¦åˆ™ï¼ˆæ¥è‡ªå…¶ä»–é…é€å™¨æˆ–æœºç”²ï¼‰
       â””â”€ é€€è¿˜åˆ°ç©å®¶èƒŒåŒ… âœ…ï¼ˆå…œåº•ï¼‰
```

**é€€è¿˜é€»è¾‘**ï¼š
- âœ… ä¼˜å…ˆé€€è¿˜åˆ°æ¥æºåŸºç«™ï¼ˆå¦‚æœæ˜¯åŸºç«™ä¾›åº”çš„ç‰©å“ï¼‰
- âœ… å¦åˆ™é€€è¿˜åˆ°ç©å®¶èƒŒåŒ…ï¼ˆå…œåº•ä¿æŠ¤ï¼‰
- âœ… ç¡®ä¿ç‰©å“ä¸ä¸¢å¤±

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### æµ‹è¯•1ï¼šæ‹†é™¤åŸºç«™ï¼ˆç©ºè½½æ— äººæœºç«‹å³è¿”å›ï¼‰

```
1. æ´¾é£å¤šä¸ªæ— äººæœºé£å‘åŸºç«™
2. åœ¨æ— äººæœºé£è¡Œåˆ°ä¸€åŠæ—¶ï¼Œæ‹†é™¤åŸºç«™
3. è§‚å¯Ÿï¼š
   - æ‰€æœ‰ç©ºè½½æ— äººæœºåº”è¯¥**ç«‹å³æ‰å¤´è¿”å›** âœ…
   - ä¸åº”è¯¥ç»§ç»­é£åˆ°åŸä½ç½® âœ…
   - idle å¿«é€Ÿæ¢å¤ âœ…
4. æŸ¥çœ‹æ—¥å¿—ï¼š
   âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[0] ç«‹å³æ‰å¤´è¿”å›
   âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[1] ç«‹å³æ‰å¤´è¿”å›
```

---

### æµ‹è¯•2ï¼šæ‹†é™¤é…é€å™¨ï¼ˆç‰©å“ä¿æŠ¤ï¼‰

```
å‡†å¤‡ï¼š
1. åŸºç«™æœ‰100ä¸ªç‡ƒæ–™æ£’
2. é…é€å™¨éœ€æ±‚ç‡ƒæ–™æ£’
3. æ´¾é£å¤šä¸ªæ— äººæœºï¼ˆæ¯”å¦‚5ä¸ªï¼‰
4. ç­‰å¾…æ— äººæœºä»åŸºç«™å–è´§å¹¶è¿”å›ï¼ˆæ­¤æ—¶æºå¸¦ç‰©å“ï¼‰

æµ‹è¯•ï¼š
5. åœ¨æ— äººæœºè¿”å›é€”ä¸­ï¼Œæ‹†é™¤é…é€å™¨
6. æ£€æŸ¥åŸºç«™ï¼šåº”è¯¥æœ‰ç‡ƒæ–™æ£’è¢«é€€è¿˜ âœ…
7. æˆ–æ£€æŸ¥ç©å®¶èƒŒåŒ…ï¼šåº”è¯¥æœ‰ç‡ƒæ–™æ£’è¢«é€€è¿˜ âœ…
8. ç»Ÿè®¡æ€»æ•°é‡ï¼šåº”è¯¥ç­‰äºå®éªŒå¼€å§‹çš„æ•°é‡ âœ…

æŸ¥çœ‹æ—¥å¿—ï¼š
[Info] æ£€æµ‹åˆ°é…é€å™¨[1]å³å°†è¢«æ‹†é™¤ï¼Œæ£€æŸ¥é£è¡Œä¸­çš„æ— äººæœº...
[Info] âœ… å·²é€€è¿˜ç‰©å“ï¼šå¥‡å¼‚æ¹®ç­ç‡ƒæ–™æ£’ x5
[Info] âœ… å·²é€€è¿˜ç‰©å“ï¼šå¥‡å¼‚æ¹®ç­ç‡ƒæ–™æ£’ x5
[Info] å·²å°†ç‰©å“é€€è¿˜åˆ°æˆ˜åœºåŸºç«™[1]
[Info] é…é€å™¨[1]æ‹†é™¤ï¼šå…±é€€è¿˜ 25 ä¸ªç‰©å“ï¼ˆ5 ä¸ªæ— äººæœºï¼‰
```

---

### æµ‹è¯•3ï¼šæ‹†é™¤è™šæ‹Ÿé…é€å™¨å¯¹åº”çš„åŸºç«™

```
å‡†å¤‡ï¼š
1. é…é€æ­£å¸¸è¿›è¡Œ
2. æœ‰å¤šä¸ªæ— äººæœºåœ¨é£è¡Œä¸­ï¼ˆç©ºè½½å»åŸºç«™ + è£…è½½è¿”å›ï¼‰

æµ‹è¯•ï¼š
3. æ‹†é™¤åŸºç«™
4. è§‚å¯Ÿï¼š
   - ç©ºè½½æ— äººæœºç«‹å³æ‰å¤´è¿”å› âœ…
   - è£…è½½æ— äººæœºç»§ç»­è¿”å›é…é€å™¨ âœ…
   - ç‰©å“æ­£å¸¸é€è¾¾ âœ…

æŸ¥çœ‹æ—¥å¿—ï¼š
[Warning] âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[0] ç«‹å³æ‰å¤´è¿”å›
[Warning] âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[1] ç«‹å³æ‰å¤´è¿”å›
ï¼ˆè£…è½½æ— äººæœºç»§ç»­è¿”å›ï¼Œæ­£å¸¸é€è¾¾ï¼‰
```

---

## ğŸ“‹ é¢„æœŸæ—¥å¿—

### åŸºç«™æ‹†é™¤ï¼ˆç©ºè½½æ— äººæœºç«‹å³è¿”å›ï¼‰

```
[Info] ğŸš å¼€å§‹æ´¾é£! é…é€å™¨[1] â†’ è™šæ‹Ÿé…é€å™¨[2](æˆ˜åœºåŸºç«™[1])
[Info] âœ… æ´¾é£æˆåŠŸ! ç©ºè½½courieré£å‘æˆ˜åœºåŸºç«™[1]
[Info] ğŸš å¼€å§‹æ´¾é£! é…é€å™¨[1] â†’ è™šæ‹Ÿé…é€å™¨[2](æˆ˜åœºåŸºç«™[1])
[Info] âœ… æ´¾é£æˆåŠŸ! ç©ºè½½courieré£å‘æˆ˜åœºåŸºç«™[1]

ï¼ˆç©å®¶æ‹†é™¤åŸºç«™ï¼‰

[Warning] âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[0] ç«‹å³æ‰å¤´è¿”å›
[Warning] âš ï¸ æˆ˜åœºåŸºç«™[1]å·²è¢«æ‹†é™¤ï¼Œcourier[1] ç«‹å³æ‰å¤´è¿”å›
ï¼ˆæ— äººæœºç«‹å³æ‰å¤´ï¼Œä¸é£åˆ°åŸä½ç½®ï¼‰
```

---

### é…é€å™¨æ‹†é™¤ï¼ˆç‰©å“é€€è¿˜ï¼‰

```
[Info] ğŸ¯ courier[0] å³å°†åˆ°è¾¾è™šæ‹Ÿé…é€å™¨[2]ï¼Œå¯¹åº”æˆ˜åœºåŸºç«™[1]
[Info] âœ… ä»æˆ˜åœºåŸºç«™[1]å–è´§æˆåŠŸï¼æ•°é‡=5ï¼Œå¼€å§‹è¿”å›é…é€å™¨
[Info] ğŸ¯ courier[1] å³å°†åˆ°è¾¾è™šæ‹Ÿé…é€å™¨[2]ï¼Œå¯¹åº”æˆ˜åœºåŸºç«™[1]
[Info] âœ… ä»æˆ˜åœºåŸºç«™[1]å–è´§æˆåŠŸï¼æ•°é‡=5ï¼Œå¼€å§‹è¿”å›é…é€å™¨

ï¼ˆæ— äººæœºè¿”å›é€”ä¸­ï¼Œç©å®¶æ‹†é™¤é…é€å™¨ï¼‰

[Info] æ£€æµ‹åˆ°é…é€å™¨[1]å³å°†è¢«æ‹†é™¤ï¼Œæ£€æŸ¥é£è¡Œä¸­çš„æ— äººæœº...
[Info] âœ… å·²é€€è¿˜ç‰©å“ï¼šå¥‡å¼‚æ¹®ç­ç‡ƒæ–™æ£’ x5
[Info] å·²å°†ç‰©å“é€€è¿˜åˆ°æˆ˜åœºåŸºç«™[1]
[Info] âœ… å·²é€€è¿˜ç‰©å“ï¼šå¥‡å¼‚æ¹®ç­ç‡ƒæ–™æ£’ x5
[Info] å·²å°†ç‰©å“é€€è¿˜åˆ°æˆ˜åœºåŸºç«™[1]
[Info] é…é€å™¨[1]æ‹†é™¤ï¼šå…±é€€è¿˜ 10 ä¸ªç‰©å“ï¼ˆ2 ä¸ªæ— äººæœºï¼‰
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç«‹å³è¿”å›çš„å®ç°

**å…³é”®ç‚¹**ï¼š
1. æ£€æŸ¥æ—¶æœºï¼šæ¯å¸§éƒ½æ£€æŸ¥ï¼ˆä¸é™äºåˆ°è¾¾æ—¶ï¼‰
2. æ£€æŸ¥æ¡ä»¶ï¼š`itemCount == 0 && direction > 0f`ï¼ˆç©ºè½½ä¸”é£å‘åŸºç«™ï¼‰
3. å¤„ç†æ–¹å¼ï¼š`direction = -1f; t = t;`ï¼ˆæ‰å¤´ï¼Œä¿æŒå½“å‰ä½ç½®ï¼‰

**ä¸ºä»€ä¹ˆ `t = t`ï¼Ÿ**
- `t` è¡¨ç¤ºé£è¡Œè¿›åº¦ï¼ˆ0åˆ°maxtï¼‰
- `direction = -1f` è¡¨ç¤ºè¿”å›æ–¹å‘
- `t = t` ä¿æŒå½“å‰è¿›åº¦ï¼Œè®©æ— äººæœºä»å½“å‰ä½ç½®å¼€å§‹è¿”å›
- æ¸¸æˆä¼šè‡ªåŠ¨å¤„ç†è¿”å›åŠ¨ç”»

---

### ç‰©å“é€€è¿˜çš„å®ç°

**å…³é”®ç‚¹**ï¼š
1. Hookæ—¶æœºï¼š`RemoveDispenserComponent` çš„ `Prefix`ï¼ˆæ‹†é™¤å‰ï¼‰
2. æ£€æŸ¥å¯¹è±¡ï¼šéå† `workCourierDatas`
3. é€€è¿˜ç­–ç•¥ï¼š
   - æ£€æŸ¥é…å¯¹ï¼Œåˆ¤æ–­æ˜¯å¦æ¥è‡ªè™šæ‹Ÿé…é€å™¨
   - å¦‚æœæ˜¯ï¼Œé€€è¿˜åˆ°åŸºç«™ï¼ˆ`StorageComponent.AddItem`ï¼‰
   - å¦åˆ™ï¼Œé€€è¿˜åˆ°ç©å®¶èƒŒåŒ…ï¼ˆ`StorageComponent.AddItem`ï¼‰

**ä¸ºä»€ä¹ˆæ£€æŸ¥é…å¯¹ï¼Ÿ**
- `CourierData` æ²¡æœ‰ `beginId` å­—æ®µ
- æ— æ³•ç›´æ¥åˆ¤æ–­ç‰©å“æ¥æº
- é€šè¿‡é…å¯¹ä¿¡æ¯ï¼ˆ`pair.supplyId`ï¼‰åˆ¤æ–­æ˜¯å¦æ¥è‡ªè™šæ‹Ÿé…é€å™¨
- å¦‚æœæ˜¯è™šæ‹Ÿé…é€å™¨é…å¯¹ï¼Œè¯´æ˜ç‰©å“æ¥è‡ªåŸºç«™

---

## ğŸ“Š ä¿®æ”¹æ–‡ä»¶æ€»ç»“

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | å½±å“ |
|------|---------|------|
| `DispenserComponent_InternalTick_Patch.cs` | æ·»åŠ é£è¡Œä¸­æŒç»­æ£€æŸ¥åŸºç«™å­˜åœ¨æ€§ | âœ… ç©ºè½½æ— äººæœºç«‹å³è¿”å› |
| `PlanetTransport_RemoveDispenserComponent_Patch.cs` | æ–°æ–‡ä»¶ï¼šæ‹†é™¤é…é€å™¨å‰é€€è¿˜ç‰©å“ | âœ… é˜²æ­¢ç‰©å“ä¸¢å¤± |
| `Plugin.cs` | æ³¨å†Œæ–°è¡¥ä¸ | âœ… å¯ç”¨ç‰©å“ä¿æŠ¤ |

---

## âœ… æ€»ç»“

### é—®é¢˜1ï¼šç©ºè½½æ— äººæœºç«‹å³è¿”å›

- **ä¿®å¤å‰**ï¼šæ— äººæœºé£åˆ°ç›®æ ‡ä½ç½®æ‰æ£€æŸ¥ï¼Œæµªè´¹æ—¶é—´ âš ï¸
- **ä¿®å¤å**ï¼šæ¯å¸§æ£€æŸ¥ï¼ŒåŸºç«™æ‹†é™¤åç«‹å³æ‰å¤´è¿”å› âœ…

---

### é—®é¢˜2ï¼šé…é€å™¨æ‹†é™¤æ—¶ç‰©å“ä¸¢å¤±

- **ä¿®å¤å‰**ï¼šé£è¡Œä¸­æ— äººæœºçš„ç‰©å“ä¼šæ¶ˆå¤± ğŸš¨
- **ä¿®å¤å**ï¼šæ‹†é™¤å‰é€€è¿˜ç‰©å“åˆ°åŸºç«™æˆ–ç©å®¶èƒŒåŒ… âœ…

---

### ç‰©å“ä¿æŠ¤æœºåˆ¶

| æ— äººæœºçŠ¶æ€ | ç‰©å“æ¥æº | é€€è¿˜ç›®æ ‡ | çŠ¶æ€ |
|-----------|----------|----------|------|
| ç©ºè½½é£å‘åŸºç«™ | æ— ç‰©å“ | æ— éœ€é€€è¿˜ | âœ… |
| è£…è½½è¿”å›é…é€å™¨ï¼ˆæ¥è‡ªåŸºç«™ï¼‰ | åŸºç«™ | é€€è¿˜åˆ°åŸºç«™ | âœ… |
| è£…è½½è¿”å›é…é€å™¨ï¼ˆæ¥è‡ªå…¶ä»–ï¼‰ | å…¶ä»– | é€€è¿˜åˆ°ç©å®¶èƒŒåŒ… | âœ… |

---

### çŠ¶æ€

âœ… **ä¸¤ä¸ªBugéƒ½å·²ä¿®å¤å¹¶ç¼–è¯‘æˆåŠŸ**

ç­‰å¾…ç”¨æˆ·æµ‹è¯•åé¦ˆã€‚

---

## ğŸ‰ æ„Ÿè°¢ç”¨æˆ·

**ç”¨æˆ·çš„æµ‹è¯•åœºæ™¯éå¸¸å…¨é¢ï¼**

è¿™ä¸¤ä¸ªå‘ç°éƒ½æ˜¯**å…³é”®é—®é¢˜**ï¼š
1. âœ… ç«‹å³è¿”å›ï¼šæå‡ç”¨æˆ·ä½“éªŒï¼ŒèŠ‚çœæ—¶é—´
2. âœ… ç‰©å“ä¿æŠ¤ï¼šé˜²æ­¢èµ„æºæŸå¤±ï¼Œè¿™æ˜¯ä¸¥é‡çš„Bug

**æ„Ÿè°¢ç”¨æˆ·çš„ç»†è‡´æµ‹è¯•å’Œå‡†ç¡®åé¦ˆï¼** ğŸ™

# é…å¯¹åˆ†ç±»å›¾ç¤º

## ğŸ“Š DispenserComponent é…å¯¹æ•°ç»„ç»“æ„

### å®Œæ•´ç»“æ„

```
DispenserComponent
â”‚
â”œâ”€ pairs[]                    â† é…å¯¹æ•°ç»„
â”‚   â”œâ”€ [0]: SupplyDemandPair
â”‚   â”œâ”€ [1]: SupplyDemandPair
â”‚   â”œâ”€ [2]: SupplyDemandPair
â”‚   â””â”€ ...
â”‚
â”œâ”€ pairCount = 5              â† æ‰€æœ‰é…å¯¹æ€»æ•°
â””â”€ playerPairCount = 2        â† è´Ÿæ•°IDé…å¯¹æ•°
```

---

## ğŸ¨ å¯è§†åŒ–ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ··åˆé…å¯¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DispenserComponent (é…é€å™¨)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pairs[] æ•°ç»„ï¼š                                 â”‚
â”‚                                                 â”‚
â”‚  [0] ç©å®¶é…å¯¹                                   â”‚
â”‚      supplyId: -1 (ç©å®¶èƒŒåŒ…)                    â”‚ â†â”
â”‚      demandId: 1 (é…é€å™¨)                       â”‚  â”‚ playerPairCount = 2
â”‚                                                 â”‚  â”‚
â”‚  [1] ç©å®¶é…å¯¹                                   â”‚  â”‚
â”‚      supplyId: -1 (ç©å®¶èƒŒåŒ…)                    â”‚ â†â”˜
â”‚      demandId: 1 (é…é€å™¨)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [2] å­˜å‚¨é…å¯¹                                   â”‚
â”‚      supplyId: 5 (ç‰©æµç«™)                       â”‚ â†â”
â”‚      demandId: 1 (é…é€å™¨)                       â”‚  â”‚
â”‚                                                 â”‚  â”‚ pairCount - playerPairCount
â”‚  [3] è™šæ‹Ÿé…é€å™¨é…å¯¹ â˜…                           â”‚  â”‚      = 3
â”‚      supplyId: 2 (è™šæ‹Ÿé…é€å™¨)                   â”‚  â”‚
â”‚      demandId: 1 (é…é€å™¨)                       â”‚  â”‚
â”‚                                                 â”‚  â”‚
â”‚  [4] å­˜å‚¨é…å¯¹                                   â”‚  â”‚
â”‚      supplyId: 7 (å¦ä¸€ä¸ªç‰©æµç«™)                 â”‚ â†â”˜
â”‚      demandId: 1 (é…é€å™¨)                       â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pairCount = 5          (0~4 å…¨éƒ¨)             â”‚
â”‚  playerPairCount = 2    (0~1 è´Ÿæ•°ID)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ç¤ºä¾‹2ï¼šåªæœ‰è™šæ‹Ÿé…é€å™¨é…å¯¹ï¼ˆæˆ‘ä»¬çš„åœºæ™¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DispenserComponent (éœ€æ±‚é…é€å™¨)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pairs[] æ•°ç»„ï¼š                                 â”‚
â”‚                                                 â”‚
â”‚  [0] è™šæ‹Ÿé…é€å™¨é…å¯¹ â˜…                           â”‚
â”‚      supplyId: 2 (è™šæ‹Ÿé…é€å™¨,ä»£è¡¨æˆ˜åœºåŸºç«™)      â”‚ â† å”¯ä¸€çš„é…å¯¹
â”‚      demandId: 1 (éœ€æ±‚é…é€å™¨)                   â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  pairCount = 1          (æœ‰1ä¸ªé…å¯¹)             â”‚
â”‚  playerPairCount = 0    (æ²¡æœ‰è´Ÿæ•°IDé…å¯¹)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®ç‚¹ï¼š
âœ… pairCount = 1        â†’ éå†æ—¶èƒ½æ‰¾åˆ°
âŒ playerPairCount = 0  â†’ éå†æ—¶æ‰¾ä¸åˆ°
```

---

## ğŸ”„ AddPair æ‰§è¡Œæµç¨‹

### æµç¨‹å›¾

```
å¼€å§‹ AddPair(sId, sIdx, dId, dIdx)
â”‚
â”œâ”€ æ·»åŠ åˆ° pairs[pairCount]
â”‚   â”‚
â”‚   â”œâ”€ pairs[pairCount].supplyId = sId
â”‚   â”œâ”€ pairs[pairCount].supplyIndex = sIdx
â”‚   â”œâ”€ pairs[pairCount].demandId = dId
â”‚   â””â”€ pairs[pairCount].demandIndex = dIdx
â”‚
â”œâ”€ pairCount++           â† æ€»æ˜¯å¢åŠ 
â”‚
â””â”€ åˆ¤æ–­: sId < 0 æˆ– dId < 0 ?
    â”‚
    â”œâ”€ æ˜¯ â†’ playerPairCount++    â† åªåœ¨è´Ÿæ•°IDæ—¶å¢åŠ 
    â”‚
    â””â”€ å¦ â†’ playerPairCount ä¸å˜  â† æ­£æ•°IDæ—¶ä¸å˜
```

---

## ğŸ“‹ ä¸åŒé…å¯¹ç±»å‹çš„å¤„ç†

### ç±»å‹1ï¼šç©å®¶é…å¯¹ï¼ˆè´Ÿæ•°IDï¼‰

```
æ·»åŠ é…å¯¹ï¼š
  AddPair(-1, 0, 1, 0)
  
  supplyId: -1 (ç©å®¶èƒŒåŒ…)
  demandId: 1  (é…é€å™¨)

ç»“æœï¼š
  pairCount: 0 â†’ 1        âœ…
  playerPairCount: 0 â†’ 1  âœ…

å¦‚ä½•è®¿é—®ï¼š
  æ–¹å¼1: éå† pairCount (0~0)      âœ… èƒ½æ‰¾åˆ°
  æ–¹å¼2: éå† playerPairCount (0~0) âœ… èƒ½æ‰¾åˆ°
```

---

### ç±»å‹2ï¼šå­˜å‚¨é…å¯¹ï¼ˆæ­£æ•°IDï¼Œç‰©æµç«™ç­‰ï¼‰

```
æ·»åŠ é…å¯¹ï¼š
  AddPair(5, 0, 1, 0)
  
  supplyId: 5 (ç‰©æµç«™çš„é…é€å™¨)
  demandId: 1 (é…é€å™¨)

ç»“æœï¼š
  pairCount: 0 â†’ 1        âœ…
  playerPairCount: 0 â†’ 0  âŒ ä¸å˜

å¦‚ä½•è®¿é—®ï¼š
  æ–¹å¼1: éå† pairCount (0~0)      âœ… èƒ½æ‰¾åˆ°
  æ–¹å¼2: éå† playerPairCount (æ— )  âŒ æ‰¾ä¸åˆ°
```

---

### ç±»å‹3ï¼šè™šæ‹Ÿé…é€å™¨é…å¯¹ï¼ˆæ­£æ•°IDï¼Œæˆ‘ä»¬çš„å®ç°ï¼‰

```
æ·»åŠ é…å¯¹ï¼š
  AddPair(2, 0, 1, 0)
  
  supplyId: 2 (è™šæ‹Ÿé…é€å™¨ï¼Œä»£è¡¨æˆ˜åœºåŸºç«™)
  demandId: 1 (éœ€æ±‚é…é€å™¨)

ç»“æœï¼š
  pairCount: 0 â†’ 1        âœ…
  playerPairCount: 0 â†’ 0  âŒ ä¸å˜

å¦‚ä½•è®¿é—®ï¼š
  æ–¹å¼1: éå† pairCount (0~0)      âœ… èƒ½æ‰¾åˆ°
  æ–¹å¼2: éå† playerPairCount (æ— )  âŒ æ‰¾ä¸åˆ°
  
ç»“è®ºï¼š
  å¿…é¡»ä½¿ç”¨ pairCountï¼
```

---

## ğŸ” éå†å¯¹æ¯”

### é”™è¯¯çš„éå†ï¼ˆä½¿ç”¨ playerPairCountï¼‰

```csharp
é…é€å™¨çŠ¶æ€ï¼š
  pairCount = 1
  playerPairCount = 0
  pairs[0] = {supplyId: 2, demandId: 1}  â† è™šæ‹Ÿé…é€å™¨é…å¯¹

âŒ é”™è¯¯ä»£ç ï¼š
for (int i = 0; i < playerPairCount; i++)  // i < 0ï¼Œå¾ªç¯ä¸æ‰§è¡Œ
{
    var pair = pairs[i];
    if (IsVirtualDispenser(pair.supplyId))
    {
        æ´¾é£();  // æ°¸è¿œä¸ä¼šæ‰§è¡Œ
    }
}

ç»“æœï¼šæ‰¾ä¸åˆ°é…å¯¹ï¼Œæ— æ³•æ´¾é£
```

---

### æ­£ç¡®çš„éå†ï¼ˆä½¿ç”¨ pairCountï¼‰

```csharp
é…é€å™¨çŠ¶æ€ï¼š
  pairCount = 1
  playerPairCount = 0
  pairs[0] = {supplyId: 2, demandId: 1}  â† è™šæ‹Ÿé…é€å™¨é…å¯¹

âœ… æ­£ç¡®ä»£ç ï¼š
for (int i = 0; i < pairCount; i++)  // i < 1ï¼Œå¾ªç¯æ‰§è¡Œ1æ¬¡
{
    var pair = pairs[i];              // è·å– pairs[0]
    if (IsVirtualDispenser(pair.supplyId))  // æ£€æŸ¥ supplyId=2
    {
        æ´¾é£();  // âœ… æ‰§è¡Œï¼
    }
}

ç»“æœï¼šæ‰¾åˆ°é…å¯¹ï¼ŒæˆåŠŸæ´¾é£
```

---

## ğŸ“Š é…å¯¹æ•°é‡å…³ç³»

### æ•°å­¦å…³ç³»

```
pairCount = playerPairCount + å…¶ä»–é…å¯¹æ•°é‡

å…¶ä¸­ï¼š
  playerPairCount  = è´Ÿæ•°IDé…å¯¹æ•°é‡
  å…¶ä»–é…å¯¹æ•°é‡     = æ­£æ•°IDé…å¯¹æ•°é‡ï¼ˆå­˜å‚¨ã€è™šæ‹Ÿé…é€å™¨ç­‰ï¼‰

å› æ­¤ï¼š
  pairCount â‰¥ playerPairCount  (æ€»æ˜¯æˆç«‹)
```

---

### å®é™…ä¾‹å­

```
åœºæ™¯1ï¼šåªæœ‰ç©å®¶é…å¯¹
  playerPairCount = 3
  pairCount = 3
  å…¶ä»–é…å¯¹ = 0

åœºæ™¯2ï¼šæ··åˆé…å¯¹
  playerPairCount = 2
  pairCount = 5
  å…¶ä»–é…å¯¹ = 3

åœºæ™¯3ï¼šåªæœ‰å­˜å‚¨é…å¯¹ï¼ˆæˆ‘ä»¬çš„åœºæ™¯ï¼‰
  playerPairCount = 0
  pairCount = 1
  å…¶ä»–é…å¯¹ = 1  â† è™šæ‹Ÿé…é€å™¨é…å¯¹
```

---

## ğŸ¯ æ ¸å¿ƒè¦ç‚¹

### 1. IDç±»å‹å†³å®šåˆ†ç±»

```
è´Ÿæ•°ID (sId < 0 æˆ– dId < 0):
  â†’ playerPairCount++
  â†’ æ”¾åœ¨ pairs æ•°ç»„å‰éƒ¨
  â†’ æ¸¸æˆç§°ä¸º"ç©å®¶é…å¯¹"

æ­£æ•°ID (sId > 0 ä¸” dId > 0):
  â†’ playerPairCount ä¸å˜
  â†’ æ”¾åœ¨ pairs æ•°ç»„åéƒ¨
  â†’ æ¸¸æˆç§°ä¸º"å­˜å‚¨é…å¯¹"æˆ–"è‡ªåŠ¨é…å¯¹"
```

---

### 2. æˆ‘ä»¬çš„è™šæ‹Ÿé…é€å™¨

```
è™šæ‹Ÿé…é€å™¨ç‰¹å¾ï¼š
  âœ… ä½¿ç”¨æ­£æ•°IDï¼ˆé¿å…æ•°ç»„è¶Šç•Œï¼‰
  âœ… å½’ç±»ä¸º"å­˜å‚¨é…å¯¹"
  âŒ ä¸è®¡å…¥ playerPairCount
  âœ… è®¡å…¥ pairCount

å¿…é¡»çš„å¤„ç†ï¼š
  âœ… éå†æ—¶ä½¿ç”¨ pairCount
  âœ… æ¡ä»¶åˆ¤æ–­ä½¿ç”¨ pairCount > 0
  âŒ ä¸èƒ½ä½¿ç”¨ playerPairCountï¼ˆæ°¸è¿œä¸º0ï¼‰
```

---

### 3. å¸¸è§è¯¯åŒº

```
âŒ è¯¯åŒº1ï¼š"playerPairCount = é…é€å™¨åˆ°é…é€å™¨çš„é…å¯¹æ•°"
   æ­£ç¡®ï¼šplayerPairCount = ä½¿ç”¨è´Ÿæ•°IDçš„é…å¯¹æ•°

âŒ è¯¯åŒº2ï¼š"è™šæ‹Ÿé…é€å™¨é…å¯¹åº”è¯¥è®¡å…¥ playerPairCount"
   æ­£ç¡®ï¼šæ­£æ•°IDé…å¯¹ä¸è®¡å…¥ playerPairCount

âŒ è¯¯åŒº3ï¼š"å¯ä»¥å¼ºåˆ¶å¢åŠ  playerPairCount"
   æ­£ç¡®ï¼šåº”è¯¥ä½¿ç”¨ pairCount éå†ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ¸¸æˆé€»è¾‘

âœ… æ­£ç¡®ç†è§£ï¼š
   - pairCountï¼šæ‰€æœ‰é…å¯¹ï¼ˆæˆ‘ä»¬è¦ç”¨è¿™ä¸ªï¼‰
   - playerPairCountï¼šè´Ÿæ•°IDé…å¯¹ï¼ˆä¸æ˜¯æˆ‘ä»¬çš„é…å¯¹ï¼‰
```

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### æ—¥å¿—æ ¼å¼

```log
æ¨èæ ¼å¼ï¼ˆåŒæ—¶æ˜¾ç¤ºä¸¤ä¸ªå­—æ®µï¼‰ï¼š
ğŸ” é…é€å™¨[1]: pairCount=5 (playerPairCount=2)

è§£è¯»ï¼š
  - æ€»å…±5ä¸ªé…å¯¹
  - å…¶ä¸­2ä¸ªæ˜¯ç©å®¶é…å¯¹ï¼ˆè´Ÿæ•°IDï¼‰
  - å…¶ä»–3ä¸ªæ˜¯å­˜å‚¨/è™šæ‹Ÿé…é€å™¨é…å¯¹ï¼ˆæ­£æ•°IDï¼‰
  
å¦‚æœçœ‹åˆ°ï¼š
ğŸ” é…é€å™¨[1]: pairCount=1 (playerPairCount=0)

è§£è¯»ï¼š
  - æ€»å…±1ä¸ªé…å¯¹
  - 0ä¸ªç©å®¶é…å¯¹
  - è¿™1ä¸ªé…å¯¹æ˜¯æ­£æ•°IDé…å¯¹ï¼ˆå¾ˆå¯èƒ½æ˜¯æˆ‘ä»¬çš„è™šæ‹Ÿé…é€å™¨ï¼‰
  - âš ï¸ å¿…é¡»éå† pairCount æ‰èƒ½æ‰¾åˆ°ï¼
```

---

## ğŸ“ æ€»ç»“è¡¨

| é…å¯¹ç±»å‹ | IDç±»å‹ | pairCount | playerPairCount | ç¤ºä¾‹ |
|---------|--------|-----------|-----------------|------|
| ç©å®¶é…å¯¹ | è´Ÿæ•°ID | âœ… å¢åŠ  | âœ… å¢åŠ  | é…é€å™¨â†’æœºç”² |
| å­˜å‚¨é…å¯¹ | æ­£æ•°ID | âœ… å¢åŠ  | âŒ ä¸å˜ | é…é€å™¨â†’ç‰©æµç«™ |
| **è™šæ‹Ÿé…é€å™¨é…å¯¹** | **æ­£æ•°ID** | **âœ… å¢åŠ ** | **âŒ ä¸å˜** | **é…é€å™¨â†’æˆ˜åœºåŸºç«™** |

**ç»“è®º**ï¼šæˆ‘ä»¬çš„è™šæ‹Ÿé…é€å™¨é…å¯¹ä¸å­˜å‚¨é…å¯¹çš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ï¼Œå¿…é¡»ä½¿ç”¨ `pairCount` æ¥è®¿é—®ï¼
